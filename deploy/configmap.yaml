apiVersion: v1
kind: ConfigMap
metadata:
  name: kong-config
  namespace: rag
data:
  kong.yml: |
    _format_version: "1.1"
    services:
      - name: auth-v1-open
        url: http://supabase-auth.rag.svc.cluster.local:9999/verify
        routes:
          - name: auth-v1-open
            strip_path: true
            paths:
              - /auth/v1/verify
        plugins:
          - name: cors
      - name: auth-v1-open-callback
        url: http://supabase-auth.rag.svc.cluster.local:9999/callback
        routes:
          - name: auth-v1-open-callback
            strip_path: true
            paths:
              - /auth/v1/callback
        plugins:
          - name: cors
      - name: auth-v1-open-authorize
        url: http://supabase-auth.rag.svc.cluster.local:9999/authorize
        routes:
          - name: auth-v1-open-authorize
            strip_path: true
            paths:
              - /auth/v1/authorize
        plugins:
          - name: cors
      - name: auth-v1
        _comment: "GoTrue: /auth/v1/* -> http://supabase-auth:9999/*"
        url: http://supabase-auth.rag.svc.cluster.local:9999/
        routes:
          - name: auth-v1-all
            strip_path: true
            paths:
              - /auth/v1/
        plugins:
          - name: cors
      - name: rest-v1
        _comment: "PostgREST: /rest/v1/* -> http://supabase-rest:3000/*"
        url: http://supabase-rest.rag.svc.cluster.local:3000/
        routes:
          - name: rest-v1-all
            strip_path: true
            paths:
              - /rest/v1/
        plugins:
          - name: cors
            config:
              origins:
                - "*"
              methods:
                - GET
                - POST
                - PATCH
                - DELETE
                - OPTIONS
              headers:
                - apikey
                - authorization
                - content-type
              exposed_headers:
                - content-range
              credentials: false
              max_age: 3600
      - name: realtime-v1
        _comment: "Realtime: /realtime/v1/* -> ws://supabase-realtime:4000/socket/*"
        url: http://supabase-realtime.rag.svc.cluster.local:4000/socket/
        routes:
          - name: realtime-v1-all
            strip_path: true
            paths:
              - /realtime/v1/
        plugins:
          - name: cors
